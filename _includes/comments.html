<div>
  <div class="divider"></div>
  <div class="comment-title">评论</div>
  <div class="add-comment">
    访问 <a href="https://github.com/BeaverTeam/BeaverMovie/issues/{{page.commentIssueId}}?#new_comment_field">GitHub Issues</a> 添加评论。
  </div>
  <div id="comments"></div>
</div>

<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/datejs/1.0/date.min.js"></script>

<script type="text/javascript">
  function loadComments(data) {
    for (var i=0; i<data.length; i++) {
      var cuser = data[i].user.login;
      var cuserlink = "https://www.github.com/" + data[i].user.login;
      var clink = "https://github.com/BeaverTeam/BeaverMovie/issues/{{page.commentIssueId}}#issuecomment-" + data[i].url.substring(data[i].url.lastIndexOf("/")+1 + "?#new_comment_field");
      var cbody = data[i].body_html;
      var cavatarlink = data[i].user.avatar_url;
      var cdate = Date.parse(data[i].created_at).toString("yyyy-MM-dd HH:mm:ss");
      $("#comments").append("<div class='comment card'><div class='commentheader card-header'><div class='commentgravatar'>" + '<img src="' + cavatarlink + '" alt="" width="24px" height="24px">' + "</div><a class='commentuser' href=\""+ cuserlink + "\">" + cuser + "</a><a class='commentdate' href=\"" + clink + "\">" + cdate + "</a></div><div class='commentbody card-body'>" + cbody + "</div></div>");
    }
  }
  $.ajax("https://api.github.com/repos/BeaverTeam/BeaverMovie/issues/{{page.commentIssueId}}/comments?per_page=10", {
    headers: {Accept: "application/vnd.github.full+json"},
    dataType: "json",
    success: function(msg){
      loadComments(msg);
   }
  });
</script>
